# Сборка мусора

## Управление памятью


-   JavaScript динамически выделяет необходимую память при объявлении переменных
-   для типа object и всех его внутренних свойвств, «объекты» включают в себя не только объекты JavaScript, но и функции с областями их видимости.
-   выделяет память для array и его внутренних значений
-   выделяет память для function
-   вызовы некоторых функций также ведут к выделению памяти под объект

```js
var d = new Date();
var e = document.createElement("div"); // выделяет память под DOM-элемент
```

- `Выделение памяти` JavaScript берет эту задачу на себя: он выделяет память, которая понадобится для созданного нами объекта.
- `Использование памяти` Это то, что мы явно прописываем в коде: чтение и запись в память – не что иное, как чтение и запись в переменную.
- `Освобождение памяти.` Этот шаг также выполняет движок JavaScript: сразу после освобождения память можно использовать для других целей.

В JavaScript же память выделяется динамически при создании сущностей (т.е., объектов, строк и т.п.) и "автоматически" освобождается, когда они больше не используются.


## Стек и куча

- `Стек` (англ. stack) – это структура данных, которая используется для хранения статических данных, т.е. тех, чей размер известен во время компиляции. В JavaScript сюда включаются примитивные значения (string, number, boolean, undefined и null) и ссылки на функции и объекты.

- `Куча` (англ. memory heap) используется для хранения таких данных, как объекты и функции. В отличие от случая со стеком, движок не знает, какой объем памяти понадобится для тех или иных объектов, а потому выделяет память по мере необходимости. Такое выделение памяти называют динамическим.

| Стек                           | Куча                          |
|--------------------------------|-------------------------------|
| Примитивные значения и ссылки  | Объекты и функции             |
| Размер известен во время компиляции | Размер известен во время выполнения |
| Выделяется фиксированный объем памяти | Объем ничем не ограничен        |
| Имена всех переменных  если значение не является примитивным, в стеке содержится ссылка на объект из кучи |              |


## Достижимость

-   Объект считается подлежащим уничтожению сборщиком мусора, если количество ссылок на него равно нулю

1. Существует базовое множество достижимых значений, которые не могут быть удалены.

Например:

-   Выполняемая в данный момент функция, её локальные переменные и параметры.
-   Другие функции в текущей цепочке вложенных вызовов, их локальные переменные и параметры.
-   Глобальные переменные.
-   (некоторые другие внутренние значения) Эти значения мы будем называть корнями.

2. Любое другое значение считается достижимым, если оно доступно из корня по ссылке или по цепочке ссылок.

```js
let user = {
    name: "John",
};

let admin = user;
user = null;
console.log("admin: ", admin);
```

## Циклическая ссылка

Циклическая ссылка возникает, когда два объекта создаются со свойствами, которые ссылаются друг на друга, тем самым создавая цикл.

```js
let one = {};
let two = {};

// one reference to two
one.object = two;

// two reference to one
two.object = one;

console.log("one: ", one);
console.log("two: ", two);
```

-   Циклические ссылки являются одной из основных причин утечек памяти.
